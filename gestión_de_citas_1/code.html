<!DOCTYPE html>
<html class="dark" lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Mis Citas - Salud Madrid</title>

<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

<style>
  .material-symbols-outlined {
      font-variation-settings:
      'FILL' 0,
      'wght' 400,
      'GRAD' 0,
      'opsz' 24
  }
</style>

<!-- ============ CORRECCIN MODO CLARO/OSCURO PARA EL TEXTO ============ -->
<style>
  /* Texto negro en modo claro */
  html:not(.dark) body * {
    color: black !important;
  }

  /* Texto blanco en modo oscuro */
  html.dark body * {
    color: white !important;
  }
</style>

<script id="tailwind-config">
  tailwind.config = {
    darkMode: "class",
    theme: {
      extend: {
        colors: {
          "primary": "#135bec",
          "background-light": "#f6f6f8",
          "background-dark": "#101622",
          "accent-green": "#4CAF50",
          "accent-red": "#D32F2F",
          "text-light": "#212121",
          "text-dark": "#F5F5F5",
          "card-light": "#ffffff",
          "card-dark": "#1c1f27",
          "subtle-light": "#e0e0e0",
          "subtle-dark": "#282e39",
          "text-subtle-light": "#616161",
          "text-subtle-dark": "#9da6b9"
        },
        fontFamily: {
          "display": ["Lexend", "sans-serif"]
        },
        borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
      },
    },
  }
</script>

</head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="relative flex h-auto min-h-screen w-full flex-col">

<!-- HEADER -->
<div class="sticky top-0 z-10 flex items-center justify-between bg-background-light dark:bg-background-dark p-4 pb-2">

  <!--  FLECHA PARA VOLVER -->
  <button onclick="window.location.href='../gesti贸n_de_citas_2/code.html'" 
          class="flex items-center justify-center">
      <span class="material-symbols-outlined text-3xl">arrow_back</span>
  </button>

  <h1 class="flex-1 text-center text-xl font-bold">Mis Citas</h1>

  <div class="flex size-12 shrink-0 items-center justify-end">
    <button id="notifButton" class="flex h-12 items-center justify-center">
      <span id="notifIcon" class="material-symbols-outlined text-3xl">notifications</span>
    </button>
  </div>
</div>

<!-- SWITCH PROXIMAS / HISTORIAL -->
<div class="px-4 py-3">
  <div class="flex h-12 items-center justify-center rounded-xl bg-subtle-light dark:bg-subtle-dark p-1">
    <label class="flex h-full flex-1 items-center justify-center rounded-lg px-2 text-base has-[:checked]:bg-primary has-[:checked]:text-white">
      <span>Pr贸ximas</span>
      <input checked name="appointment-filter" type="radio" value="Proximas" class="hidden" />
    </label>
    <label class="flex h-full flex-1 items-center justify-center rounded-lg px-2 text-base has-[:checked]:bg-primary has-[:checked]:text-white">
      <span>Historial</span>
      <input name="appointment-filter" type="radio" value="Historial" class="hidden" />
    </label>
  </div>
</div>

<!-- DAS -->
<div id="daysContainer" class="flex gap-3 overflow-x-auto p-4 pt-2 scrollbar-hide">
  <div class="dayItem flex h-16 flex-col items-center justify-center gap-y-1 rounded-xl bg-subtle-light dark:bg-subtle-dark px-4 py-2 cursor-pointer" data-day="21">
    <p class="text-sm">Lun</p><p class="text-lg font-bold">21</p>
  </div>

  <div class="dayItem flex h-16 flex-col items-center justify-center gap-y-1 rounded-xl bg-subtle-light dark:bg-subtle-dark px-4 py-2 cursor-pointer" data-day="22">
    <p class="text-sm">Mar</p><p class="text-lg font-bold">22</p>
  </div>

  <div class="dayItem flex h-16 flex-col items-center justify-center gap-y-1 rounded-xl bg-subtle-light dark:bg-subtle-dark px-4 py-2 cursor-pointer" data-day="23">
    <p class="text-sm">Mi茅</p><p class="text-lg font-bold">23</p>
  </div>

  <div class="dayItem flex h-16 flex-col items-center justify-center gap-y-1 bg-primary text-white px-4 py-2 cursor-pointer" data-day="24">
    <p class="text-sm">Hoy</p><p class="text-lg font-bold">24</p>
  </div>

  <div class="dayItem flex h-16 flex-col items-center justify-center gap-y-1 rounded-xl bg-subtle-light dark:bg-subtle-dark px-4 py-2 cursor-pointer" data-day="25">
    <p class="text-sm">Vie</p><p class="text-lg font-bold">25</p>
  </div>
</div>

<!-- CONTENEDOR DE CITAS -->
<main class="flex flex-col gap-4 px-4 pb-28 pt-4" id="appointmentsContainer"></main>

<!-- MODAL CONFIRMACIN -->
<div id="confirmModal" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50">
  <div class="bg-white dark:bg-card-dark p-6 rounded-xl shadow-lg w-80">
    <p class="text-lg font-medium mb-4">驴Est谩s seguro de cancelar esta cita?</p>
    <div class="flex justify-end gap-3">
      <button id="cancelNo" class="px-4 py-2 rounded-lg bg-subtle-light dark:bg-subtle-dark">No</button>
      <button id="cancelYes" class="px-4 py-2 rounded-lg bg-accent-red text-white">S铆</button>
    </div>
  </div>
</div>

<script>
// =================== CAMPANA =======================
const notifBtn = document.getElementById("notifButton");
const notifIcon = document.getElementById("notifIcon");
let notifActive = false;

// Tick superpuesto
const theTick = document.createElement("span");
theTick.className = "material-symbols-outlined text-green-400 text-base absolute -top-1 -right-1";
theTick.textContent = "check_circle";
theTick.style.display = "none";
notifBtn.style.position = "relative";
notifBtn.appendChild(theTick);

notifBtn.addEventListener("click", () => {
  notifActive = !notifActive;
  theTick.style.display = notifActive ? "block" : "none";
});

// =================== CITAS =========================
const citas = {
  Proximas: {
    24: [
      {
        hora: "10:30h",
        persona: "Dr. Alejandro Sanz",
        tipo: "M茅dico de Familia",
        modalidad: "Telef贸nica"
      },
      {
        hora: "12:15h",
        persona: "Enfermera Luc铆a Ferreiro",
        tipo: "Cita de Enfermer铆a",
        lugar: "Centro de Salud Goya, Consulta 5",
        modalidad: "Presencial"
      }
    ],
    22: [{ hora: "09:00h", persona: "Dentista", tipo: "Revisi贸n", modalidad: "Presencial" }],
    25: [{ hora: "17:30h", persona: "Fisioterapia", tipo: "Sesi贸n", modalidad: "Presencial" }]
  },
  Historial: {
    21: [{ hora: "11:00h", persona: "Dr. Morales", tipo: "General", modalidad: "Presencial" }]
  }
};

// Render citas
function renderCitas(dia, modo) {
  const cont = document.getElementById("appointmentsContainer");
  cont.innerHTML = "";
  const lista = citas[modo][dia] || [];

  if (lista.length === 0) {
    cont.innerHTML = `<p class='text-center mt-10'>No hay citas.</p>`;
    return;
  }

  lista.forEach((cita, idx) => {
    const card = document.createElement("div");
    card.className = "citaCard flex flex-col gap-4 rounded-xl bg-card-light dark:bg-card-dark p-4 shadow-sm";
    card.dataset.index = idx;

    card.innerHTML = `
      <div class="flex justify-between">
        <div>
          <p class="text-lg font-bold">${cita.hora}</p>
          <p class="text-base">${cita.persona}</p>
          <p class="text-sm">${cita.tipo}</p>
          ${cita.lugar ? `<p class='text-sm mt-1'>${cita.lugar}</p>` : ""}
        </div>
        <div class="flex items-center gap-2 rounded-full bg-primary/20 px-3 py-1">
          <span class="material-symbols-outlined text-primary text-base">${cita.modalidad === "Presencial" ? "location_on" : "call"}</span>
          <p class="text-sm font-medium text-primary">${cita.modalidad}</p>
        </div>
      </div>

      <div class="flex gap-2 pt-2">
        <button class="btnCancelar flex-1 h-11 bg-accent-red text-white rounded-lg">Cancelar</button>
        <button class="flex-1 h-11 bg-subtle-light dark:bg-subtle-dark rounded-lg" onclick="window.location.href='../gesti贸n_de_citas_4/code.html'">Modificar</button>
      </div>
    `;

    cont.appendChild(card);
  });

  activarBotonesCancelar(dia);
}

// ================== DAS ==========================
let diaSeleccionado = 24;
let modoSeleccionado = "Proximas";

renderCitas(diaSeleccionado, modoSeleccionado);

document.querySelectorAll(".dayItem").forEach(item => {
  item.addEventListener("click", () => {
    document.querySelectorAll(".dayItem").forEach(d => d.classList.remove("bg-primary", "text-white"));
    item.classList.add("bg-primary", "text-white");

    diaSeleccionado = item.dataset.day;
    renderCitas(diaSeleccionado, modoSeleccionado);
  });
});

// ============== Cambiar entre pr贸ximas e historial ==============
document.querySelectorAll("input[name='appointment-filter']").forEach(r => {
  r.addEventListener("change", () => {
    modoSeleccionado = r.value;
    renderCitas(diaSeleccionado, modoSeleccionado);
  });
});

// ================= CONFIRMACIN CANCELAR ========================
let citaAEliminar = null;
function activarBotonesCancelar(dia) {
  document.querySelectorAll(".btnCancelar").forEach((btn, index) => {
    btn.addEventListener("click", () => {
      citaAEliminar = index;
      document.getElementById("confirmModal").classList.remove("hidden");
    });
  });
}

document.getElementById("cancelNo").addEventListener("click", () => {
  document.getElementById("confirmModal").classList.add("hidden");
});

document.getElementById("cancelYes").addEventListener("click", () => {
  if (citaAEliminar != null) {
    citas[modoSeleccionado][diaSeleccionado].splice(citaAEliminar, 1);
    renderCitas(diaSeleccionado, modoSeleccionado);
  }
  document.getElementById("confirmModal").classList.add("hidden");
});
</script>

<script src="../shared/settings.js"></script>

</div>
</body>
</html>
