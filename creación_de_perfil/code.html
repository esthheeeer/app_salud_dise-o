<!DOCTYPE html>
<html class="dark" lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Crear Nuevo Perfil</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>

<script id="tailwind-config">
tailwind.config = {
    darkMode: "class",
    theme: {
      extend: {
        colors: {
          "primary": "#135bec",
          "background-light": "#f6f6f8",
          "background-dark": "#101622",
        },
        fontFamily: {
          "display": ["Lexend", "sans-serif"]
        },
        borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
      },
    },
}
</script>

<style>
.material-symbols-outlined {
    font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
}

body {
  min-height: max(884px, 100dvh);
}

.dark input,
.dark textarea {
    color: white !important;
    caret-color: white !important;
}
.dark input::placeholder,
.dark textarea::placeholder {
    color: #d1d5db !important;
}

.error-text {
    font-size: 13px;
    margin-top: 4px;
    min-height: 18px;
}
.input-error {
    border-color: #ef4444 !important;
}
</style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display">
<div class="relative flex h-auto min-h-screen w-full flex-col">

<header class="flex items-center p-4 pb-2 justify-between sticky top-0 bg-background-light dark:bg-background-dark z-10">

<button type="button"
  onclick="window.location.href='../index.html'"
  class="text-slate-800 dark:text-white flex size-12 shrink-0 items-center justify-center pointer-events-auto relative z-20">
  <span class="material-symbols-outlined text-2xl">arrow_back</span>
</button>

<h1 class="text-slate-800 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center -ml-12 pointer-events-none">
  Crear Nuevo Perfil
</h1>

</header>

<main class="flex flex-col flex-1 px-4">

<div class="pt-6 pb-3">
<h2 class="text-slate-900 dark:text-white tracking-tight text-[32px] font-bold leading-tight text-left">Crea tu perfil</h2>
<p class="text-slate-600 dark:text-slate-400 text-base font-normal leading-normal pt-1">
Introduce tus datos para acceder a tus servicios de salud.
</p>
</div>

<div class="flex flex-col gap-y-3">

<div class="flex flex-col">
<label class="text-slate-800 dark:text-white text-base font-medium leading-normal pb-2" for="nombre">Nombre</label>
<input id="nombre" type="text" placeholder="Escribe tu nombre"
class="form-input w-full rounded-lg h-14 p-[15px] border border-slate-300 dark:border-[#3b4354] bg-white dark:bg-[#1c1f27]"/>
</div>

<div class="flex flex-col">
<label class="text-slate-800 dark:text-white text-base font-medium leading-normal pb-2" for="apellidos">Apellidos</label>
<input id="apellidos" type="text" placeholder="Escribe tus apellidos"
class="form-input w-full rounded-lg h-14 p-[15px] border border-slate-300 dark:border-[#3b4354] bg-white dark:bg-[#1c1f27]"/>
</div>

<div class="flex flex-col">
<label class="text-slate-800 dark:text-white text-base font-medium leading-normal pb-2" for="dni">DNI / NIE</label>
<input id="dni" type="text" placeholder="12345678A"
class="form-input w-full rounded-lg h-14 p-[15px] border border-slate-300 dark:border-[#3b4354] bg-white dark:bg-[#1c1f27]"/>
<p id="error-dni" class="error-text text-red-500"></p>
</div>

<div class="flex flex-col">
<label class="text-slate-800 dark:text-white text-base font-medium leading-normal pb-2" for="fecha_nacimiento">Fecha de Nacimiento</label>
<input id="fecha_nacimiento" type="date"
class="form-input w-full rounded-lg h-14 p-[15px] border border-slate-300 dark:border-[#3b4354] bg-white dark:bg-[#1c1f27]"/>
</div>

<div class="flex flex-col">
<label class="text-slate-800 dark:text-white text-base font-medium leading-normal pb-2" for="telefono">Número de Teléfono</label>
<input id="telefono" type="tel" placeholder="600 000 000"
class="form-input w-full rounded-lg h-14 p-[15px] border border-slate-300 dark:border-[#3b4354] bg-white dark:bg-[#1c1f27]"/>
</div>

<div class="flex flex-col">
<label class="text-slate-800 dark:text-white text-base font-medium leading-normal pb-2" for="email">Correo Electrónico</label>
<input id="email" type="email" placeholder="tu@correo.com"
class="form-input w-full rounded-lg h-14 p-[15px] border border-slate-300 dark:border-[#3b4354] bg-white dark:bg-[#1c1f27]"/>
<p id="error-email" class="error-text text-red-500"></p>
</div>

<div class="flex flex-col">
<label class="text-slate-800 dark:text-white text-base font-medium leading-normal pb-2" for="password">Contraseña</label>
<input id="password" type="password" placeholder="Escribe tu contraseña"
class="form-input w-full rounded-lg h-14 p-[15px] border border-slate-300 dark:border-[#3b4354] bg-white dark:bg-[#1c1f27]"/>
<p id="error-password" class="error-text text-red-500"></p>
<p class="text-xs text-slate-500 dark:text-slate-400 mt-1">
Debe tener al menos 8 caracteres, una mayúscula y un número.
</p>
</div>

<div class="flex flex-col">
<label class="text-slate-800 dark:text-white text-base font-medium leading-normal pb-2" for="password2">Repetir Contraseña</label>
<input id="password2" type="password" placeholder="Repite tu contraseña"
class="form-input w-full rounded-lg h-14 p-[15px] border border-slate-300 dark:border-[#3b4354] bg-white dark:bg-[#1c1f27]"/>
<p id="error-password2" class="error-text text-red-500"></p>
</div>

</div>

<div class="flex-grow"></div>

<div class="py-6 flex flex-col gap-4 sticky bottom-0 bg-background-light dark:bg-background-dark">
<button id="btn-registrarse" type="button"
class="flex items-center justify-center text-white text-base font-bold leading-normal bg-primary rounded-xl h-14 w-full transition-colors hover:bg-primary/90 disabled:bg-slate-300 dark:disabled:bg-slate-700 disabled:text-slate-500 dark:disabled:text-slate-400"
disabled>
Registrarse
</button>

<p class="text-center text-xs text-slate-500 dark:text-slate-400">
Al registrarte, aceptas nuestros
<a class="font-medium text-primary hover:underline" href="#">Términos de Servicio</a>
y
<a class="font-medium text-primary hover:underline" href="#">Política de Privacidad</a>.
</p>
</div>

</main>
</div>

<script>
const campos = ["nombre","apellidos","dni","fecha_nacimiento","telefono","email","password","password2"];
const boton = document.getElementById("btn-registrarse");
const inputDNI = document.getElementById("dni");
const inputEmail = document.getElementById("email");
const inputPassword = document.getElementById("password");
const inputPassword2 = document.getElementById("password2");
const spanErrorDNI = document.getElementById("error-dni");
const spanErrorEmail = document.getElementById("error-email");
const spanErrorPass = document.getElementById("error-password");
const spanErrorPass2 = document.getElementById("error-password2");

function validarDNI(dniInput) {
    const dni = dniInput.toUpperCase().replace(/\s+/g,'');
    const regex = /^[XYZ]?\d{5,8}[A-Z]$/;
    if (!regex.test(dni)) return false;

    const letras = "TRWAGMYFPDXBNJZSQVHLCKE";
    const numeroStr = dni.slice(0, -1).replace('X','0').replace('Y','1').replace('Z','2');
    const numero = parseInt(numeroStr, 10);
    const letra = dni.slice(-1);
    if (isNaN(numero)) return false;
    return letras[numero % 23] === letra;
}

function validarEmailSimple(email) {
    if (!email) return false;
    const e = email.trim().toLowerCase();
    return e.includes('@') && e.endsWith('.com');
}

function validarPassword(pass) {
    if (!pass) return false;
    const tieneMayus = /[A-Z]/.test(pass);
    const tieneNumero = /\d/.test(pass);
    const tiene8 = pass.length >= 8;
    return tieneMayus && tieneNumero && tiene8;
}

function todosLosCamposRellenos() {
    return campos.every(id => {
        const el = document.getElementById(id);
        return el && el.value.trim() !== "";
    });
}

function comprobarYMostrarErrores() {
    const dniVal = inputDNI.value.trim();
    const dniValido = validarDNI(dniVal);
    if (dniVal === "") {
        spanErrorDNI.textContent = "";
        inputDNI.classList.remove('input-error');
    } else if (!dniValido) {
        spanErrorDNI.textContent = "Formato de DNI/NIE incorrecto.";
        inputDNI.classList.add('input-error');
    } else {
        spanErrorDNI.textContent = "";
        inputDNI.classList.remove('input-error');
    }

    const emailVal = inputEmail.value.trim();
    const emailValido = validarEmailSimple(emailVal);
    if (emailVal === "") {
        spanErrorEmail.textContent = "";
        inputEmail.classList.remove('input-error');
    } else if (!emailValido) {
        spanErrorEmail.textContent = "El correo debe contener '@' y terminar en '.com'.";
        inputEmail.classList.add('input-error');
    } else {
        spanErrorEmail.textContent = "";
        inputEmail.classList.remove('input-error');
    }

    const passVal = inputPassword.value;
    const passValido = validarPassword(passVal);
    if (passVal === "") {
        spanErrorPass.textContent = "";
        inputPassword.classList.remove('input-error');
    } else if (!passValido) {
        spanErrorPass.textContent = "Contraseña no cumple los requisitos.";
        inputPassword.classList.add('input-error');
    } else {
        spanErrorPass.textContent = "";
        inputPassword.classList.remove('input-error');
    }

    const pass2Val = inputPassword2.value;
    if (pass2Val === "") {
        spanErrorPass2.textContent = "";
        inputPassword2.classList.remove('input-error');
    } else if (pass2Val !== passVal) {
        spanErrorPass2.textContent = "Las contraseñas no coinciden.";
        inputPassword2.classList.add('input-error');
    } else {
        spanErrorPass2.textContent = "";
        inputPassword2.classList.remove('input-error');
    }

    const habilitar = todosLosCamposRellenos() && dniValido && emailValido && passValido && passVal === pass2Val;
    boton.disabled = !habilitar;
}

campos.forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    el.addEventListener('input', comprobarYMostrarErrores);
});

boton.addEventListener('click', (ev) => {
    if (boton.disabled) {
        ev.preventDefault();
        return;
    }
    window.location.href = "../index.html";
});
</script>

<script src="../shared/settings.js"></script>
</body>
</html>
