<!DOCTYPE html>
<html class="dark" lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Salud Madrid - Iniciar Sesión</title>

<!-- TAILWIND -->
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

<!-- FUENTES -->
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>

<style>
.material-symbols-outlined {
  font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24;
  line-height: 1;
}

/* MISMA ALTURA Y PROPORCIÓN QUE LA PRIMERA PANTALLA */
body {
  min-height: max(884px, 100dvh);
}

/* Sombra del panel */
.a11y-panel { 
  box-shadow: 0 6px 18px rgba(2,6,23,0.12); 
}
</style>

<!-- CONFIG TAILWIND -->
<script id="tailwind-config">
tailwind.config = {
  darkMode: "class",
  theme: {
    extend: {
      colors: {
        "primary": "#135bec",
        "background-light": "#f6f6f8",
        "background-dark": "#101622",
      },
      fontFamily: { "display": ["Lexend", "sans-serif"] },
      borderRadius: {
        DEFAULT: "0.25rem", "lg": "0.5rem", "xl": "0.75rem", full: "9999px"
      }
    }
  }
}
</script>

<!-- VALIDACIÓN -->
<script>
function validarCampos() {
  const dni = document.getElementById("dni").value.trim();
  const pass = document.getElementById("pass").value.trim();
  const boton = document.getElementById("boton-login");
  const dniError = document.getElementById("dni-error");
  const passError = document.getElementById("pass-error");

  const dniRegex = /^[0-9]{8}[A-Za-z]$/;

  if (dni !== "" && !dniRegex.test(dni)) {
    dniError.textContent = "Formato de DNI incorrecto. Ejemplo: 12345678A";
  } else {
    dniError.textContent = "";
  }

  if (pass !== "" && pass.length < 8) {
    passError.textContent = "La contraseña debe tener al menos 8 caracteres";
  } else {
    passError.textContent = "";
  }

  if (dniRegex.test(dni) && pass.length >= 8) {
    boton.disabled = false;
    boton.classList.remove("opacity-50", "cursor-not-allowed");
    boton.classList.add("hover:bg-blue-700");
  } else {
    boton.disabled = true;
    boton.classList.add("opacity-50", "cursor-not-allowed");
    boton.classList.remove("hover:bg-blue-700");
  }
}

function intentarLogin() {
  const dni = document.getElementById("dni").value.trim();
  const pass = document.getElementById("pass").value.trim();
  const mensaje = document.getElementById("login-error");

  const dniRegex = /^[0-9]{8}[A-Za-z]$/;

  mensaje.textContent = "";

  if (dni === "" || pass === "") {
    mensaje.textContent = "Debes completar todos los campos.";
    return;
  }

  if (!dniRegex.test(dni)) {
    mensaje.textContent = "El DNI no tiene un formato válido.";
    return;
  }

  if (pass.length < 8) {
    mensaje.textContent = "La contraseña necesita mínimo 8 caracteres.";
    return;
  }

  window.location.href = '../../salud_madrid_home/code.html';
}
</script>

</head>

<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200 antialiased">

<div class="relative flex min-h-screen w-full flex-col items-center justify-center p-4">

<div class="w-full max-w-md space-y-8">

<!-- PANEL ACCESIBILIDAD (MISMA POSICIÓN, NO AFECTA DISEÑO) -->
<div class="absolute top-4 right-4 z-20">
  <button id="a11yToggle" aria-expanded="false" aria-controls="a11yPanel" class="bg-transparent p-1">
    <span class="material-symbols-outlined text-3xl text-gray-600 dark:text-gray-300 hover:text-primary cursor-pointer">settings</span>
  </button>

  <div id="a11yPanel" class="hidden mt-2 w-64 right-0 origin-top-right rounded-lg bg-white dark:bg-gray-900 p-3 a11y-panel">
    <h3 class="text-sm font-semibold text-gray-800 dark:text-gray-100 mb-2">Accesibilidad</h3>

    <div class="flex items-center justify-between py-1">
      <div>
        <p class="text-sm font-medium text-gray-700 dark:text-gray-200">Modo</p>
        <p class="text-xs text-gray-500 dark:text-gray-400">Claro / Oscuro</p>
      </div>
      <label class="inline-flex relative items-center cursor-pointer">
        <input type="checkbox" id="themeToggle" class="sr-only peer">
        <div class="w-11 h-6 bg-gray-300 rounded-full peer-checked:bg-blue-600 transition-colors"></div>
        <span id="themeKnob" class="absolute left-0 top-0 w-6 h-6 bg-white rounded-full transition-transform peer-checked:translate-x-5"></span>
      </label>
    </div>

    <div class="pt-2">
      <p class="text-sm font-medium text-gray-700 dark:text-gray-200">Tamaño del texto</p>
      <input id="textSize" type="range" min="14" max="22" step="1" value="16" class="w-full mt-2">
      <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">Valor: <span id="textSizeValue">16</span>px</div>
    </div>

    <div class="pt-3 flex items-center gap-2">
      <button id="startRead" class="flex-1 text-sm py-2 px-3 rounded-lg bg-primary text-white">Leer</button>
      <button id="stopRead" class="flex-1 text-sm py-2 px-3 rounded-lg border">Parar</button>
    </div>

    <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">Ajustes guardados en este equipo.</p>
  </div>
</div>

<!-- LOGO (MISMO QUE LA PRIMERA PANTALLA) -->
<div class="text-center">
<svg class="mx-auto h-12 w-auto text-primary" fill="currentColor" viewBox="0 0 24 24">
<path clip-rule="evenodd" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 
10-4.48 10-10S17.52 2 12 2Zm-1 15v-4H8v-2h3V7h2v4h3v2h-3v4h-2Z" 
fill-rule="evenodd"></path>
</svg>

<h1 class="mt-6 text-3xl font-bold tracking-tight text-gray-900 dark:text-white">
Bienvenido a Salud Madrid
</h1>
<p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Accede para gestionar tu salud</p>
</div>

<!-- FORM -->
<div class="space-y-6">

<!-- DNI -->
<label class="flex flex-col">
<p class="text-sm font-medium pb-2 text-black dark:text-white">DNI / NIE</p>
<div class="flex items-stretch rounded-lg shadow-sm">
<div class="text-gray-400 dark:text-gray-500 flex border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 items-center justify-center pl-4 rounded-l-lg border-r-0">
<span class="material-symbols-outlined text-base">person</span>
</div>
<input id="dni" oninput="validarCampos()"
 class="form-input flex w-full min-w-0 text-gray-900 dark:text-white 
        placeholder-black dark:placeholder-white
        focus:ring-2 focus:ring-primary border border-gray-300 dark:border-gray-700 
        bg-white dark:bg-gray-900 h-12 p-3 rounded-r-lg"
 placeholder="Ejemplo: 12345678A" type="text"/>
</div>
<p id="dni-error" class="text-red-500 text-xs mt-1"></p>
</label>

<!-- PASSWORD -->
<label class="flex flex-col">
<p class="text-sm font-medium pb-2 text-black dark:text-white">Contraseña</p>
<div class="flex items-stretch rounded-lg shadow-sm">
<div class="text-gray-400 dark:text-gray-500 flex border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 items-center justify-center pl-4 rounded-l-lg border-r-0">
<span class="material-symbols-outlined text-base">lock</span>
</div>

<input id="pass" oninput="validarCampos()"
 class="form-input flex w-full min-w-0 text-gray-900 dark:text-white
        placeholder-black dark:placeholder-white
        focus:ring-2 focus:ring-primary border border-gray-300 dark:border-gray-700 
        bg-white dark:bg-gray-900 h-12 p-3"
 placeholder="Mínimo 8 caracteres" type="password"/>

<button type="button" id="toggle-pass"
  class="text-gray-400 dark:text-gray-500 hover:text-primary dark:hover:text-primary flex border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 items-center justify-center pr-4 rounded-r-lg border-l-0">
  <span id="icon-pass" class="material-symbols-outlined text-base">visibility</span>
</button>

</div>
<p id="pass-error" class="text-red-500 text-xs mt-1"></p>
</label>

<div class="text-right">
<a class="text-sm font-medium text-primary hover:underline"
   href="../../recuperar_contraseña/code.html">
   ¿Has olvidado tu contraseña?
</a>
</div>
</div>

<!-- BOTONES -->
<div class="space-y-4">
<button id="boton-login"
        disabled
        onclick="intentarLogin()"
        class="flex w-full cursor-not-allowed items-center justify-center rounded-lg h-12 px-5 bg-primary text-white font-bold opacity-50 transition-all active:scale-95">
  Iniciar Sesión
</button>

<p id="login-error" class="text-red-500 text-center text-sm"></p>

<!-- OPCIONES -->
<div class="flex flex-col gap-2 text-sm text-gray-700 dark:text-gray-300">
  <label class="flex items-center gap-2">
    <input type="checkbox"> Recordar usuario
  </label>
  <label class="flex items-center gap-2">
    <input type="checkbox"> Usar biometría
  </label>
</div>

<p class="text-center text-sm text-gray-600 dark:text-gray-400">
¿No tienes cuenta? <a class="font-bold text-primary hover:underline" href="../../creación_de_perfil/code.html">Regístrate aquí</a>
</p>
</div>

<!-- FOOTER -->
<div class="border-t border-gray-200 dark:border-gray-800 pt-6">
  <div class="flex items-center justify-center gap-6 text-sm">
    <a class="flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-primary"
       href="../../sección_de_ayuda/code.html">
       <span class="material-symbols-outlined text-lg">help_outline</span> Ayuda
    </a>
    <div class="h-4 border-l border-gray-300 dark:border-gray-700"></div>
    <a class="flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-primary"
       href="../../contactar_soporte/code.html">
       <span class="material-symbols-outlined text-lg">support_agent</span> Contactar Soporte
    </a>
  </div>
</div>

</div>
</div>

<script src="../../shared/settings.js"></script>

<script>
/* Mostrar/ocultar contraseña */
const inputPass = document.getElementById("pass");
const togglePass = document.getElementById("toggle-pass");
const iconPass = document.getElementById("icon-pass");

togglePass.addEventListener("click", () => {
  const oculto = inputPass.type === "password";
  inputPass.type = oculto ? "text" : "password";
  iconPass.textContent = oculto ? "visibility_off" : "visibility";
});

/* Panel accesibilidad */
const a11yToggle = document.getElementById('a11yToggle');
const a11yPanel = document.getElementById('a11yPanel');
const themeToggle = document.getElementById('themeToggle');
const textSize = document.getElementById('textSize');
const textSizeValue = document.getElementById('textSizeValue');
const startRead = document.getElementById('startRead');
const stopRead = document.getElementById('stopRead');
const botonLogin = document.getElementById('boton-login');

/* Aplicar preferencias guardadas */
(function applyPrefs(){
  const theme = localStorage.getItem('sm_theme');
  if (theme === 'dark') document.documentElement.classList.add('dark');
  if (theme === 'dark') themeToggle.checked = true;

  const size = localStorage.getItem('sm_textsize');
  if (size) {
    document.documentElement.style.fontSize = size + 'px';
    textSize.value = size;
    textSizeValue.textContent = size;
  } else {
    document.documentElement.style.fontSize = '16px';
    textSize.value = 16;
    textSizeValue.textContent = 16;
  }
})();

/* Abrir/cerrar panel */
a11yToggle.addEventListener('click', (e)=>{
  const open = a11yPanel.classList.toggle('hidden') === false;
  a11yToggle.setAttribute('aria-expanded', open);
});

/* Cambiar tema */
themeToggle.addEventListener('change', ()=>{
  if (themeToggle.checked) {
    document.documentElement.classList.add('dark');
    localStorage.setItem('sm_theme','dark');
  } else {
    document.documentElement.classList.remove('dark');
    localStorage.setItem('sm_theme','light');
  }
});

/* Tamaño texto */
textSize.addEventListener('input', (e)=>{
  const val = e.target.value;
  document.documentElement.style.fontSize = val + 'px';
  textSizeValue.textContent = val;
  localStorage.setItem('sm_textsize', val);
});

/* Lector */
let synth = window.speechSynthesis;
function getReadableText(){
  const container = document.querySelector('.w-full.max-w-md') || document.body;
  const nodes = container.querySelectorAll('h1,h2,p,label,button,a,span');
  let text = '';
  nodes.forEach(n => {
    if (n.offsetParent !== null) text += ' ' + n.innerText.trim();
  });
  return text.trim();
}

startRead.addEventListener('click', ()=>{
  if (!synth) return;
  synth.cancel();
  const text = getReadableText();
  if (!text) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = 'es-ES';
  utter.rate = 1;
  synth.speak(utter);
});

stopRead.addEventListener('click', ()=> synth.cancel());

/* Cerrar panel al hacer clic fuera */
document.addEventListener('click', (ev)=>{
  const target = ev.target;
  if (!a11yPanel.contains(target) && !a11yToggle.contains(target)){
    a11yPanel.classList.add('hidden');
    a11yToggle.setAttribute('aria-expanded','false');
  }
});

/* Feedback visual botón login */
botonLogin.addEventListener('mousedown', ()=> botonLogin.classList.add('bg-blue-800'));
botonLogin.addEventListener('mouseup', ()=> botonLogin.classList.remove('bg-blue-800'));
</script>

</body>
</html>
